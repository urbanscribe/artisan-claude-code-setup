# /restoreralphwiggam - Intelligent Recovery from System Disruptions

## Purpose
Execute intelligent recovery from CLAUDE.md overwrites and system disruptions with registry priority. This implements the critical "Registry over Memory" principle that preserves project physics integrity when generic commands (/init) overwrite specialized configurations.

## Recovery Priority Logic
**MANDATORY STATE SYNC**: Read PROJECT_REGISTRY.json first for recovery intelligence
**Priority Order Enforcement**:
1. **PROJECT_REGISTRY.json** (Highest Priority): Complete state preservation
2. **Documentation Scan**: keygoals.md, architecture.md hash validation
3. **Invariant Reconstruction**: CLAUDE.md physics restoration
4. **Sprint Context Rebuild**: Available artifacts and postmortems

## Recovery Workflow
1. **MANDATORY STATE SYNC**: Read PROJECT_REGISTRY.json ‚Üí Determine recovery scope
2. **Registry Priority Assessment**: Evaluate registry integrity and completeness
3. **Documentation Validation**: Cross-reference with documentation/main/ files
4. **Invariant Reconstruction**: Restore CLAUDE.md from registry physics
5. **Sprint Context Restoration**: Rebuild from artifacts and postmortems
6. **Recovery Completion**: Emit appropriate promise tag

## Recovery Scenarios Handled

### Scenario 1: CLAUDE.md Overwrite by /init
**Trigger**: Generic /init command overwrites specialized CLAUDE.md
**Recovery**: Registry priority reconstruction
```
RECOVERY DETECTED: CLAUDE.md overwrite by generic command
üîÑ PRIORITY RECOVERY: PROJECT_REGISTRY.json state preservation
‚úÖ FOUNDATION: Restored from registry (keygoals_hash, architecture_hash)
‚úÖ SPRINTS: Active sprint context maintained
‚úÖ INVARIANTS: CLAUDE.md physics reconstructed
‚úÖ COMMANDS: Professional OS commands restored
<promise>RECOVERED</promise>
```

### Scenario 2: Partial Registry Corruption
**Trigger**: PROJECT_REGISTRY.json partially corrupted
**Recovery**: Documentation-based reconstruction
```
RECOVERY DETECTED: Registry corruption detected
üîÑ FALLBACK RECOVERY: Documentation hash validation
‚úÖ FOUNDATION: Rebuilt from keygoals.md, architecture.md
‚úÖ SPRINTS: Partial reconstruction from postmortems
‚ö†Ô∏è DEGRADED: Some sprint context lost
<promise>PARTIAL</promise>
```

### Scenario 3: Complete State Loss
**Trigger**: Both registry and documentation compromised
**Recovery**: Minimal invariant restoration
```
RECOVERY DETECTED: Complete state loss
üîÑ MINIMAL RECOVERY: CLAUDE.md invariant restoration only
‚úÖ INVARIANTS: Core physics restored
‚ùå FOUNDATION: Not recoverable from available sources
‚ùå SPRINTS: No context available
<promise>MINIMAL</promise>
```

## Recovery Confidence Levels
**FULL RECOVERY**: Complete PROJECT_REGISTRY.json reconstruction
- Foundation state: 100% preserved
- Sprint context: 100% maintained
- Professional workflows: Fully operational

**PARTIAL RECOVERY**: Documentation-based foundation reconstruction
- Foundation state: 80% from documentation
- Sprint context: 50% from postmortems
- Professional workflows: Core functionality restored

**MINIMAL RECOVERY**: CLAUDE.md invariant restoration only
- Foundation state: 0% recoverable
- Sprint context: 0% recoverable
- Professional workflows: Basic physics restored

## Required Skills
- **recovery-specialist**: Executes intelligent salvage operations with registry priority
- Model: default (standard operations)
- Context: fork (isolated recovery work)
- Permissions: read, write (registry reconstruction)

## Recovery Output Format
```
ü©π SYSTEM RECOVERY EXECUTED
============================

üîç RECOVERY ASSESSMENT
Registry Integrity: [FULL/PARTIAL/MINIMAL]
Documentation Available: [keygoals.md, architecture.md found/checked]
Sprint Context: [preserved/reconstructed/not available]

üìã RECOVERY ACTIONS TAKEN
‚úÖ PROJECT_REGISTRY.json prioritized over overwritten CLAUDE.md
‚úÖ Foundation state restored from registry/documentation
‚úÖ CLAUDE.md invariants reconstructed
‚úÖ Sprint context rebuilt from available artifacts
‚úÖ Professional OS commands restored

üéØ RECOVERY STATUS
Confidence Level: [FULL/PARTIAL/MINIMAL]
System Operational: [YES/DEGRADED/MINIMAL]
Professional Workflows: [ENABLED/DEGRADED/DISABLED]

<promise>RECOVERED</promise> | <promise>PARTIAL</promise> | <promise>MINIMAL</promise>
============================
```

## Error Handling
- **Registry Not Found**: "‚ö†Ô∏è No PROJECT_REGISTRY.json found. Recovery requires setup.sh --restore."
- **Documentation Missing**: "‚ö†Ô∏è Documentation files missing. Partial recovery only possible."
- **Corruption Unrecoverable**: "üö´ State corruption beyond recovery scope. Manual reconstruction required."

## Integration
- **Registry Priority**: JSON state always takes precedence over memory/CLaude.md
- **Graceful Degradation**: System continues operation at appropriate capability level
- **Professional Continuity**: Recovery maintains established workflows and quality controls
- **State Preservation**: Project physics integrity protected against generic overwrites

## Professional Discipline
This command implements the critical "Registry over Memory" principle that prevents project physics loss when generic AI commands overwrite specialized professional configurations. Recovery is intelligent, prioritized, and maintains the professional operating system integrity.
